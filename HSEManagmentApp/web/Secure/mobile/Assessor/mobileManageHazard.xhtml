<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:pm="http://primefaces.org/mobile">
    <h:head>
        <title>Add Hazard</title>
    </h:head>
    <h:body>



        <ui:composition template="/Templates/Mobile/mobTemplate.xhtml">

            <ui:define name="content">


                
                <h:form>
                    <p:growl id="growl" autoUpdate="true" sticky="true"/>
                    <h:messages/>

                    <p:dialog id='action' widgetVar="actionDialog">
                        <h:outputText value="Add Action"/>
                        <p:selectOneMenu id="users" value="#{manageHazardBean.theUserId}" required="false">
                            <f:selectItem itemLabel="Select User"  noSelectionOption="true" />
                            <f:selectItems value="#{manageHazardBean.users}" var="userList"
                                           itemLabel="#{userList.fullName}" itemValue="#{userList.userId}"/>

                        </p:selectOneMenu>
                        <p:inputTextarea id="actionText" value="#{manageHazardBean.theAction.actionDescription}" title="Action Text" required="false" />
                        <p:commandButton id="addAction" update="growl"  value="Add Action" process="action"
                                         oncomplete="PF('actionDialog').hide();" actionListener="#{manageHazardBean.addAction()}" ajax="true">
                            <f:param name="cid" value="#{manageHazardBean.conversationId}"/>
                        </p:commandButton>

                    </p:dialog>


                    <!--<p:tabView id="hazardtab" >-->
                    <p:accordionPanel id="acPanel">
                        <p:tab title="Select Process Step">
                            <pm:field>
                                <p:selectOneMenu id="ProcessStep" value="#{manageHazardBean.theHazard.processStepId}" converter="#{processStepConverter}">
                                    <f:selectItem itemLabel="Select Process Step"  noSelectionOption="true" />
                                    <f:selectItems value="#{manageHazardBean.processSteps}" var="PStep"
                                                   itemLabel="#{PStep.processStepName}" itemValue="#{PStep}"/>
                                </p:selectOneMenu>
                            </pm:field>
                        </p:tab>

                        <p:tab title="Select Category" id="catTab">

                            <p:outputLabel value="Category:" for="category" />
                            <p:selectOneMenu id="category" value="#{manageHazardBean.theHazard.category}">
                                <p:ajax process="@this" listener="#{manageHazardBean.updateSubCategories}"  update="wrapper"  />
                                <f:param name="cid" value="#{manageHazardBean.conversationId}"></f:param>

                                <f:selectItems value="#{manageHazardBean.categories}"  />


                            </p:selectOneMenu>


                            <p:outputLabel value="SubCategory:" for="subCategory" />
                            <p:outputPanel id="wrapper">
                                <p:selectOneMenu id="subCategory" value="#{manageHazardBean.theHazard.subCategory}">
                                    <f:selectItem itemLabel="Select Sub Category" itemValue="" noSelectionOption="true" />
                                    <f:selectItems value="#{manageHazardBean.subCategory}" var="cat"
                                                   itemLabel="#{cat}" itemValue="#{cat}"/>
                                </p:selectOneMenu>
                            </p:outputPanel>

                        </p:tab>
                        <p:tab title="How">
                            <pm:field>
                                <p:outputLabel value="How:" for="how" />
                                <p:inputTextarea id="how" value="#{manageHazardBean.theHazard.how}" title="How" />
                            </pm:field>
                        </p:tab>
                        <p:tab title="Injury Type">
                            <pm:field>
                                <p:outputLabel value="InjuryType:" for="injuryType" />
                                <p:selectOneMenu id="injuryType" value="#{manageHazardBean.theHazard.injuryType}">
                                    <f:selectItems value="#{manageHazardBean.injuryTypes}" var="type"
                                                   itemLabel="#{type}" itemValue="#{type.displayName}"/>

                                </p:selectOneMenu>
                                <p:message for="injuryType" />

                            </pm:field>
                            <pm:field>
                                <p:outputLabel value="Routine:" for="routine" />
                                <p:selectBooleanCheckbox id="routine" itemLabel="Routine?" value="#{manageHazardBean.theHazard.routine}"/>
                                <p:message for="routine" />
                            </pm:field>
                            <pm:field>
                                <p:outputLabel value="Injured Parties" for="InjuredP" />
                                <p:selectCheckboxMenu id="InjuredP" label="Injured Parties" value="#{manageHazardBean.theHazard.injuredPartyCollection}"
                                                      converter="#{injuredPartyConverter}">
                                    <f:selectItems value="#{manageHazardBean.injuredParties}" var="injParty"
                                                   itemLabel="#{injParty.partyType}" itemValue="#{injParty}"/>

                                </p:selectCheckboxMenu>
                            </pm:field>


                        </p:tab>
                        <p:tab title="Asset">
                            <pm:field>


                                <p:outputLabel value="AssetId:" for="assetId" />
                                <p:selectOneMenu id="assetId" value="#{manageHazardBean.theHazard.assetId}" converter="#{assetConverter}" >
                                    <f:selectItem itemLabel="Select Asset"  noSelectionOption="true" />
                                    <f:selectItems value="#{manageHazardBean.assets}" var="asset"
                                                   itemValue="#{asset}"  itemLabel="#{asset.assetName}"  />
                                </p:selectOneMenu>

                            </pm:field>  
                        </p:tab>
                        <p:tab title="Image">
                            <pm:field>
                                <p:fileUpload value="" mode="simple"  />
                            </pm:field>
                        </p:tab>
                        <p:tab title="Precontrol Assessment">
                            <pm:field>
                                <p:outputLabel value="Likelihood:" for="like" />
                                <p:selectOneMenu id="like" value="#{manageHazardBean.theHazard.precontrolAssessment.likelihood}"  >
                                    <f:selectItem itemLabel="Select Likelihood"  noSelectionOption="true" />
                                    <f:selectItems value="#{manageHazardBean.assesmentCalc.likelihood}"   />
                                </p:selectOneMenu>
                            </pm:field>
                            <pm:field>
                            <p:outputLabel value="Severity:" for="sev" />
                            <p:selectOneMenu id="sev" value="#{manageHazardBean.theHazard.precontrolAssessment.consequence}"  >
                                <f:selectItem itemLabel="Select Severity"  noSelectionOption="true" />
                                <f:selectItems value="#{manageHazardBean.assesmentCalc.severity}"   />
                            </p:selectOneMenu>
                            </pm:field>

                        </p:tab>

                        <!--Post Control Measure Code-->
                        <p:tab title="Control Measures" id="cmTab">
                            <pm:field>
                                <p:selectOneMenu id="controlMeasure" value="#{manageHazardBean.theControlMeasure.controlCategory}"
                                                 required="false" requiredMessage="Control Measure Is Required"  validatorMessage="Control Measure must have value">
                                    <f:selectItem itemLabel="Select Control Measure" value="#{null}" noSelectionOption="true"/>
                                    <f:selectItems value="#{manageHazardBean.controlMeasureValues}" var="cmVal"
                                                   itemLabel="#{cmVal.displayName}" itemValue="#{cmVal.displayName}"/>
                                </p:selectOneMenu>
                                <p:message for="controlMeasure"/>
                            </pm:field>
                            <pm:field>


                                <p:inputTextarea id="ControlText" value="#{manageHazardBean.theControlMeasure.controlDescription}" title="Measure in place" required="false"/>
                                <p:message for="ControlText"/>
                            </pm:field>
                            <pm:field>
                                <p:commandButton  value="Add Control Measure" actionListener="#{manageHazardBean.addControlMeasure()}" ajax="true"
                                                  update="@form" process="cmTab">
                                    <f:param name="cid" value="#{manageHazardBean.conversationId}"></f:param>
                                </p:commandButton>
                            </pm:field>
                            <pm:field>


                                <p:dataTable id="cmTable" value="#{manageHazardBean.theHazard.controlMeasureCollection}" var="cm">
                                    <p:column>
                                        <p:outputLabel value="#{cm.controlCategory}"/>
                                    </p:column>
                                    <p:column>
                                        <p:commandButton  oncomplete="PF('actionDialog').show();" value="Add Action" process="@this" >
                                            <f:param name="cid" value="#{manageHazardBean.conversationId}"></f:param>
                                            <f:setPropertyActionListener value="#{cm}" target="#{manageHazardBean.selectedControlMeasure}"/>
                                        </p:commandButton>
                                    </p:column>
                                </p:dataTable>
                            </pm:field>
                        </p:tab>

                        <!--Post Control Assessment Code-->
                        <p:tab id="pcTab" title="Post Control Assessment" rendered="#{manageHazardBean.postControlRenderCheck()}">
                            <pm:field>
                            <p:outputLabel value="Likelihood:" for="likePost" />
                            <p:selectOneMenu id="likePost" value="#{manageHazardBean.theHazard.postcontrolAssessment.likelihood}" required="false"  >
                                <f:selectItem itemLabel="Select Likelihood"  noSelectionOption="true" />
                                <f:selectItems value="#{manageHazardBean.assesmentCalc.likelihood}"   />
                            </p:selectOneMenu>
                            </pm:field>
                            <pm:field>
                            <p:outputLabel value="Severity:" for="sevPost" />
                            <p:selectOneMenu id="sevPost" value="#{manageHazardBean.theHazard.postcontrolAssessment.consequence}" required="false" >
                                <f:selectItem itemLabel="Select Severity"  noSelectionOption="true" />
                                <f:selectItems value="#{manageHazardBean.assesmentCalc.severity}"   />
                            </p:selectOneMenu>
                            </pm:field>

                        </p:tab>

                    </p:accordionPanel>
                    <!--</p:tabView>-->
                    <p:commandButton id="saveHazard" value="Save Hazard" actionListener="#{manageHazardBean.saveHazard()}" ajax="false" process="acPanel">
                        <f:param name="cid" value="#{manageHazardBean.conversationId}"/>
                    </p:commandButton>

                </h:form>



            </ui:define>
          
        </ui:composition>
    </h:body>
</html>

